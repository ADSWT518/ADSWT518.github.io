<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>在ArchLinux下使用QEMU/KVM和Virt Manager安装Windows虚拟机 - Yazhou Tang (唐亚周)</title><link rel="icon" type="image/png" href=https://img.icons8.com/external-those-icons-lineal-color-those-icons/24/000000/external-rice-restaurant-those-icons-lineal-color-those-icons.png /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="以及解决虚拟机无网络的问题" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://www.tangda.me/posts/2025-05-09-libvirt-install-windows/">
  <meta property="og:site_name" content="Yazhou Tang (唐亚周)">
  <meta property="og:title" content="在ArchLinux下使用QEMU/KVM和Virt Manager安装Windows虚拟机">
  <meta property="og:description" content="以及解决虚拟机无网络的问题">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-09T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-05-09T00:00:00+00:00">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="虚拟机">
    <meta property="article:tag" content="Debug">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="在ArchLinux下使用QEMU/KVM和Virt Manager安装Windows虚拟机">
  <meta name="twitter:description" content="以及解决虚拟机无网络的问题">
<script src="https://www.tangda.me/js/feather.min.js"></script>
	
	
        <link href="https://www.tangda.me/css/fonts.07926cba08f8aefb2b6f175d5d45dddce0fa79cabb73630dc8a28f280b8f95ff.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.tangda.me/css/main.5cebd7d4fb2b97856af8d32a6def16164fcf7d844e98e236fcb3559655020373.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://www.tangda.me/css/dark.d22e2a2879d933a4b781535fc4c4c716e9f9d35ea4986dd0cbabda82effc4bdd.css"  disabled />
	

	
	

	
	

	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://www.tangda.me/">Yazhou Tang (唐亚周)</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">Blog</a>
		
		<a href="/misc">Misc</a>
		
		| <span id="dark-mode-toggle" onclick="toggleTheme()"></span>
		<script src="https://www.tangda.me/js/themetoggle.js"></script>
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">在ArchLinux下使用QEMU/KVM和Virt Manager安装Windows虚拟机</h1>
			<div class="description">
	
	以及解决虚拟机无网络的问题
	
</div>
			<div class="meta">Posted on May 9, 2025</div>
		</div>
		

		

		<section class="body">
			<h2 id="安装系统前的准备">安装系统前的准备</h2>
<p>参考：https://ivonblog.com/posts/archlinux-qemu-virt-manager/</p>
<p>安装必要的包</p>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo pacman -S qemu-full libvirt virt-manager
</span></span></code></pre></div><p>还有一些utils包，缺啥装啥</p>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo pacman -S dnsmasq 
</span></span></code></pre></div><p>启动服务</p>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl <span style="color:#cb4b16">enable</span> --now libvirtd
</span></span><span style="display:flex;"><span>sudo virsh net-start default
</span></span><span style="display:flex;"><span>sudo virsh net-autostart default
</span></span></code></pre></div><p>把当前用户加到用户组</p>
<div class="highlight"><pre tabindex="0" style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo gpasswd -a <span style="color:#268bd2">$USER</span> libvirt
</span></span><span style="display:flex;"><span>sudo gpasswd -a <span style="color:#268bd2">$USER</span> kvm
</span></span></code></pre></div><h2 id="安装windows-10系统">安装Windows 10系统</h2>
<p>参考：https://ivonblog.com/posts/install-windows-11-qemu-kvm-on-linux/</p>
<h3 id="问题排查无网络">问题排查：无网络</h3>
<p>我使用的是NAT模式（懒得配置桥接了），网卡选择了virtio模式。问题在于virtio模式也需要安装特定驱动，否则windows上无法识别网卡。</p>
<p>DeepSeek表示：</p>
<blockquote>
<p>在下载并挂载了virtio-win.iso之后：</p>
<p>在Windows中安装驱动​​：打开设备管理器 → 右键未知设备 → 更新驱动程序 → 浏览ISO中的NetKVM目录（根据系统选择w10或w11）。</p></blockquote>
<h2 id="代理设置">代理设置</h2>
<p>宿主机代理软件开启port sharing，然后通过宿主机运行<code>ip addr</code>或虚拟机运行<code>ipconfig</code>获取虚拟机的默认网关，最后在虚拟机设置中填入到代理服务器即可。</p>
<h2 id="使用virtiofs共享文件夹">使用VirtioFS共享文件夹</h2>
<p>参考：https://ivonblog.com/posts/libvirt-virtiofs/</p>
<h2 id="todo">TODO</h2>
<ul>
<li>窗口分辨率的设置</li>
<li>经常用着用着就死机了，好像也没啥好办法 &#x1f607;</li>
</ul>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/linux">Linux</a></li>
					
					<li><a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA">虚拟机</a></li>
					
					<li><a href="/tags/debug">Debug</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2025  © Yazhou Tang |  <a 
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a> | Made with ❤️
  </div>
</footer>


</div>
    </body>
</html>
