<!doctype html><html><head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>程序含有多个文件时构造函数的默认值问题 - YazhouTang</title><link rel=icon type=image/png href=https://img.icons8.com/external-those-icons-lineal-color-those-icons/24/000000/external-rice-restaurant-those-icons-lineal-color-those-icons.png><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="初学C++时的一次debug记录">
<meta property="og:image" content>
<meta property="og:title" content="程序含有多个文件时构造函数的默认值问题">
<meta property="og:description" content="初学C++时的一次debug记录">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.tangda.me/posts/2019-12-11-%E7%A8%8B%E5%BA%8F%E5%90%AB%E6%9C%89%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E6%97%B6%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC%E9%97%AE%E9%A2%98/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-12-11T00:00:00+00:00">
<meta property="article:modified_time" content="2019-12-11T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="程序含有多个文件时构造函数的默认值问题">
<meta name=twitter:description content="初学C++时的一次debug记录">
<script src=https://www.tangda.me/js/feather.min.js></script>
<link href=https://www.tangda.me/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet>
<link rel=stylesheet type=text/css media=screen href=https://www.tangda.me/css/main.2f9b5946627215dc1ae7fa5f82bfc9cfcab000329136befeea5733f21e77d68f.css>
<link rel=stylesheet type=text/css href=https://www.tangda.me/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)">
</head>
<body>
<div class=content><header>
<div class=main>
<a href=https://www.tangda.me/>YazhouTang</a>
</div>
<nav>
<a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a>
</nav>
</header>
<main>
<article>
<div class=title>
<h1 class=title>程序含有多个文件时构造函数的默认值问题</h1>
<div class=meta>Posted on Dec 11, 2019</div>
</div>
<section class=body>
<blockquote>
<p>本文原载于 <a href=https://blog.csdn.net/qq_45377501/article/details/103499442>https://blog.csdn.net/qq_45377501/article/details/103499442</a> ，是大一初学C++时的一次debug记录。</p>
</blockquote>
<p>如果想在定义对象时可以指定初值也可以不指定，可以在类中设计一个带默认值的构造函数。下面这个程序：</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#93a1a1;font-style:italic>//文件：main.cpp
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#93a1a1;font-style:italic>#include</span> <span style=color:#93a1a1;font-style:italic>&#34;example.h&#34;</span><span style=color:#93a1a1;font-style:italic>
</span><span style=color:#93a1a1;font-style:italic>#include</span> <span style=color:#93a1a1;font-style:italic>&lt;iostream&gt;</span><span style=color:#93a1a1;font-style:italic>
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#859900>using</span> <span style=color:#859900>namespace</span> <span style=color:#268bd2>std</span>;

<span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>main</span>()
{
    <span style=color:#268bd2>hello</span> <span style=color:#268bd2>A</span>(<span style=color:#2aa198;font-weight:700>2</span>), <span style=color:#268bd2>B</span>;
    <span style=color:#268bd2>A</span>.<span style=color:#268bd2>print</span>();
    <span style=color:#268bd2>B</span>.<span style=color:#268bd2>print</span>();
    <span style=color:#859900>return</span> <span style=color:#2aa198;font-weight:700>0</span>;
}

<span style=color:#93a1a1;font-style:italic>//文件：example.h
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#93a1a1;font-style:italic>#ifndef EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic>#define EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic></span>
<span style=color:#859900>class</span> <span style=color:#cb4b16>hello</span>{
<span style=color:#859900>private</span>:
    <span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>b</span>;
<span style=color:#859900>public</span>:
    <span style=color:#268bd2>hello</span>(<span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>c</span>);
    <span style=color:#859900;font-weight:700>void</span> <span style=color:#268bd2>print</span>();
};
<span style=color:#93a1a1;font-style:italic>#endif </span><span style=color:#93a1a1;font-style:italic>// EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic></span>
<span style=color:#93a1a1;font-style:italic>//文件：example.cpp
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#93a1a1;font-style:italic>#include</span> <span style=color:#93a1a1;font-style:italic>&#34;example.h&#34;</span><span style=color:#93a1a1;font-style:italic>
</span><span style=color:#93a1a1;font-style:italic>#include</span> <span style=color:#93a1a1;font-style:italic>&lt;iostream&gt;</span><span style=color:#93a1a1;font-style:italic>
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#859900>using</span> <span style=color:#859900>namespace</span> <span style=color:#268bd2>std</span>;
<span style=color:#268bd2>hello</span>::<span style=color:#268bd2>hello</span>(<span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>c</span>)
{
    <span style=color:#268bd2>b</span> = <span style=color:#268bd2>c</span>;
}

<span style=color:#859900;font-weight:700>void</span> <span style=color:#268bd2>hello</span>::<span style=color:#268bd2>print</span>()
{
    <span style=color:#268bd2>cout</span> &lt;&lt;<span style=color:#268bd2>b</span>;
}
</code></pre></div><p>在编译时会报错：</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>error: no matching <span style=color:#859900>function</span> <span style=color:#859900>for</span> call to <span style=color:#2aa198>&#39;hello::hello()&#39;</span>
</code></pre></div><p>是因为我们定义的构造函数必须要指定初值</p>
<p>而如果把类的执行文件改成这样：</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#93a1a1;font-style:italic>//文件：example.cpp
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#93a1a1;font-style:italic>#include</span> <span style=color:#93a1a1;font-style:italic>&#34;example.h&#34;</span><span style=color:#93a1a1;font-style:italic>
</span><span style=color:#93a1a1;font-style:italic>#include</span> <span style=color:#93a1a1;font-style:italic>&lt;iostream&gt;</span><span style=color:#93a1a1;font-style:italic>
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#859900>using</span> <span style=color:#859900>namespace</span> <span style=color:#268bd2>std</span>;


<span style=color:#268bd2>hello</span>::<span style=color:#268bd2>hello</span>(<span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>c</span>=<span style=color:#2aa198;font-weight:700>0</span>)<span style=color:#93a1a1;font-style:italic>//加上了一个默认值
</span><span style=color:#93a1a1;font-style:italic></span>{
    <span style=color:#268bd2>b</span> = <span style=color:#268bd2>c</span>;
}

<span style=color:#859900;font-weight:700>void</span> <span style=color:#268bd2>hello</span>::<span style=color:#268bd2>print</span>()
{
    <span style=color:#268bd2>cout</span> &lt;&lt;<span style=color:#268bd2>b</span>;
}
</code></pre></div><p>却仍然出现了同样的错误：</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>error: no matching <span style=color:#859900>function</span> <span style=color:#859900>for</span> call to <span style=color:#2aa198>&#39;hello::hello()&#39;</span>
</code></pre></div><p>而如果不改变执行文件而改变头文件中构造函数的声明：</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#93a1a1;font-style:italic>//文件：example.h
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#93a1a1;font-style:italic>#ifndef EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic>#define EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic></span>
<span style=color:#859900>class</span> <span style=color:#cb4b16>hello</span>{
<span style=color:#859900>private</span>:
    <span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>b</span>;
<span style=color:#859900>public</span>:
    <span style=color:#268bd2>hello</span>(<span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>c</span>=<span style=color:#2aa198;font-weight:700>0</span>);<span style=color:#93a1a1;font-style:italic>//加上了一个默认值
</span><span style=color:#93a1a1;font-style:italic></span>    <span style=color:#859900;font-weight:700>void</span> <span style=color:#268bd2>print</span>();
};
<span style=color:#93a1a1;font-style:italic>#endif </span><span style=color:#93a1a1;font-style:italic>// EXAMPLE_H_INCLUDED
</span></code></pre></div><p>则编译通过</p>
<p>而如果执行文件和头文件的构造函数都加上默认值：</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#93a1a1;font-style:italic>//文件：example.h
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#93a1a1;font-style:italic>#ifndef EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic>#define EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic></span>
<span style=color:#859900>class</span> <span style=color:#cb4b16>hello</span>{
<span style=color:#859900>private</span>:
    <span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>b</span>;
<span style=color:#859900>public</span>:
    <span style=color:#268bd2>hello</span>(<span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>c</span>=<span style=color:#2aa198;font-weight:700>0</span>);<span style=color:#93a1a1;font-style:italic>//加上了一个默认值
</span><span style=color:#93a1a1;font-style:italic></span>    <span style=color:#859900;font-weight:700>void</span> <span style=color:#268bd2>print</span>();
};
<span style=color:#93a1a1;font-style:italic>#endif </span><span style=color:#93a1a1;font-style:italic>// EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic></span>
<span style=color:#93a1a1;font-style:italic>//文件：example.cpp
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#93a1a1;font-style:italic>#include</span> <span style=color:#93a1a1;font-style:italic>&#34;example.h&#34;</span><span style=color:#93a1a1;font-style:italic>
</span><span style=color:#93a1a1;font-style:italic>#include</span> <span style=color:#93a1a1;font-style:italic>&lt;iostream&gt;</span><span style=color:#93a1a1;font-style:italic>
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#859900>using</span> <span style=color:#859900>namespace</span> <span style=color:#268bd2>std</span>;
<span style=color:#268bd2>hello</span>::<span style=color:#268bd2>hello</span>(<span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>c</span>=<span style=color:#2aa198;font-weight:700>0</span>)<span style=color:#93a1a1;font-style:italic>//加上了一个默认值
</span><span style=color:#93a1a1;font-style:italic></span>{
    <span style=color:#268bd2>b</span> = <span style=color:#268bd2>c</span>;
}

<span style=color:#859900;font-weight:700>void</span> <span style=color:#268bd2>hello</span>::<span style=color:#268bd2>print</span>()
{
    <span style=color:#268bd2>cout</span> &lt;&lt;<span style=color:#268bd2>b</span>;
}
</code></pre></div><p>则在编译时会报错：</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>error: default argument given <span style=color:#859900>for</span> parameter <span style=color:#2aa198;font-weight:700>1</span> of <span style=color:#2aa198>&#39;hello::hello(int)&#39;</span> [-fpermissive]
</code></pre></div><p>这是因为函数参数的默认值不可以在声明和定义时都给出</p>
<p>当声明和定义在同一个文件中时，默认值可以在两个地方的任意一个地方给出；可是分开成两个文件时，就只能在声明时给出了。</p>
<p>再做尝试，将构造函数放入头文件中：</p>
<div class=highlight><pre tabindex=0 style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#93a1a1;font-style:italic>//文件：example.h
</span><span style=color:#93a1a1;font-style:italic></span><span style=color:#93a1a1;font-style:italic>#ifndef EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic>#define EXAMPLE_H_INCLUDED
</span><span style=color:#93a1a1;font-style:italic></span>
<span style=color:#859900>class</span> <span style=color:#cb4b16>hello</span>{
<span style=color:#859900>private</span>:
    <span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>b</span>;
<span style=color:#859900>public</span>:
    <span style=color:#268bd2>hello</span>(<span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>c</span>);
    <span style=color:#859900;font-weight:700>void</span> <span style=color:#268bd2>print</span>();
};

<span style=color:#268bd2>hello</span>::<span style=color:#268bd2>hello</span>(<span style=color:#859900;font-weight:700>int</span> <span style=color:#268bd2>c</span>=<span style=color:#2aa198;font-weight:700>0</span>)<span style=color:#93a1a1;font-style:italic>//定义处加上了一个默认值
</span><span style=color:#93a1a1;font-style:italic></span>{
    <span style=color:#268bd2>b</span> = <span style=color:#268bd2>c</span>;
}

<span style=color:#859900;font-weight:700>void</span> <span style=color:#268bd2>hello</span>::<span style=color:#268bd2>print</span>()
{
    <span style=color:#268bd2>cout</span> &lt;&lt;<span style=color:#268bd2>b</span>;
}
<span style=color:#93a1a1;font-style:italic>#endif </span><span style=color:#93a1a1;font-style:italic>// EXAMPLE_H_INCLUDED
</span></code></pre></div><p>编译通过</p>
<p><strong>思考：类的用户在使用类的时候主要是借助头文件来知道这个类是如何使用的，而不会去看执行文件。如果在执行文件中给出了参数的默认值，很有可能被用户所忽略。所以c++可能规定，必须在头文件中给出默认值，这是很有实用意义的。而如果写在一个文件中，用户也可以看到函数的定义，可能因此c++允许在定义时给出默认值。</strong></p>
</section>
<div class=post-tags>
<nav class="nav tags">
<ul class=tags>
<li><a href=/tags/c++>C++</a></li>
</ul>
</nav>
</div>
</article>
</main>
<footer>
<hr><a class=soc href=mailto:tangyazhou518@outlook.com title=Mail><i data-feather=mail></i></a>|<a class=soc href=https://github.com/ADSWT518/ title=Github><i data-feather=github></i></a>|<a class=soc href=https://twitter.com/AndrewTang518 title=Twitter><i data-feather=twitter></i></a>|⚡️
2021 © Yazhou Tang | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a>
</footer>
<script>feather.replace()</script></div>
</body>
</html>